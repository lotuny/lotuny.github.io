<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>剑指Offer面试题7：重建二叉树 | Lotuny's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="/css/dark.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><div class="darkmode-toggle">🌓</div><script>var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
var toggle = document.querySelector('.darkmode-toggle');
var html = document.querySelector('html');

html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

toggle.addEventListener('click', () => {
localStorage.dark = !(html.dataset.dark == 'true');
html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 5.4.1"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">剑指Offer面试题7：重建二叉树</h1><a id="logo" href="/.">Lotuny's Blog</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">剑指Offer面试题7：重建二叉树</h1><div class="post-meta">2022-03-02<span> | </span><span class="category"><a href="/categories/Coding-Interview-Edition-2/">Coding Interview Edition 2</a></span></div><div class="post-content"><p><strong>树</strong>是一种常见数据结构，它的逻辑很简单：除根节点外的每个节点只有一个父节点，根节点没有父节点；除叶节点外所有所有节点都有一个或多个子节点，叶节点没有子节点。<strong>二叉树</strong>是树的一种特殊结构，其每个节点最多只能有两个子节点。</p>
<span id="more"></span>

<table>
<thead>
<tr>
<th>输入某二叉树的前序遍历和中序遍历的结果，请重建该二叉树。假设输入的前序遍历和中序遍历的结果中都不含重复的数字。例如，输入前序遍历序列{1, 2, 4, 7, 3, 5, 6, 8}和中序遍历序列{4, 7, 2, 1, 5, 3, 8, 6}，则重建如下图所示的二叉树并输出它的头节点。</br>LeetCode力扣链接：[<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/zhong-jian-er-cha-shu-lcof/]">https://leetcode-cn.com/problems/zhong-jian-er-cha-shu-lcof/]</a></th>
</tr>
</thead>
</table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 二叉树节点的定义如下：</span><br><span class="line">struct BinaryTreeNode</span><br><span class="line">&#123;</span><br><span class="line">    int                    m_nValue;</span><br><span class="line">    BinaryTreeNode*        m_pLeft;</span><br><span class="line">    BinaryTreeNode*        m_pRight;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>思考一下两种遍历方式的特点。前序遍历序列中的第一个数字为根节点的值，且紧跟其后的值必然属于它的子节点，同时右子树节点必然只会出现在左子树节点后面；而中序遍历中的根节点的值在序列中间，且左子树节点的值位于根节点的值的左边，右子树节点的值则位于根节点的值的右边。</p>
<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>那么，我们可以通过前序遍历序列确定根节点，然后在中序遍历序列中用根节点找到左右子树，再依据找到的左右子树节点数量在前序遍历序列中找到对应的左右子树的前序遍历序列；这时我们会发现两个序列都被一分为二了，并且一一对应。于是我们可以通过不断重建左右子树并返回其根节点，最终重建出一个原始的树。</p>
<p><strong>注意</strong>：二叉树中不含重复数字是这道题可解的必要条件。</p>
<h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><p>以题目为例，我们有前序遍历序列{1, 2, 4, 7, 3, 5, 6, 8}和中序遍历序列{4, 7, 2, 1, 5, 3, 8, 6}。</p>
<p>首先我们从前序遍历序列中找到根节点的值1，然后在中序遍历序列中确定了{4, 7, 2}为左子树节点的中序遍历以及{5, 3, 8, 6}为右子树节点的中序遍历；已知左子树有3个节点，现在回头看前序遍历序列找到根节点1的后3位{2, 4, 7}确定为左子树节点前序遍历序列，紧接着的4位{3, 5, 6, 8}为右子树节点前序遍历序列。现在我们就有了树的根节点以及左右子树的前序遍历序列和中序遍历序列：<br>根节点：{1}<br>左子树：前序{2, 4, 7} 中序{4, 7, 2}<br>右子树：前序{3, 5, 6, 8} 中序{5, 3, 8, 6}</p>
<p>如图所示，我们可以迭代获得所有左右子树的根节点及前中序遍历序列，最终重构出原始的树。<br><img src="/2022/03/02/coding-interview/coding-interview-7/rebuild-tree-example.jpg"></p>
<h3 id="原文代码-C-C"><a href="#原文代码-C-C" class="headerlink" title="原文代码(C/C++)"></a>原文代码(C/C++)</h3><p><a target="_blank" rel="noopener" href="https://github.com/zhedahht/CodingInterviewChinese2/blob/master/07_ConstructBinaryTree/ConstructBinaryTree.cpp">https://github.com/zhedahht/CodingInterviewChinese2/blob/master/07_ConstructBinaryTree/ConstructBinaryTree.cpp</a></p>
<h3 id="个人编写代码-C"><a href="#个人编写代码-C" class="headerlink" title="个人编写代码(C#)"></a>个人编写代码(C#)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">public class BuildTreeSolution</span><br><span class="line">&#123;</span><br><span class="line">    private int[] preorder;</span><br><span class="line">    private int[] inorder;</span><br><span class="line"></span><br><span class="line">    public TreeNode BuildTree(int[] preorder, int[] inorder)</span><br><span class="line">    &#123;</span><br><span class="line">        if (preorder == null || inorder == null || preorder.Length != inorder.Length || inorder.Length == 0)</span><br><span class="line">            return null;</span><br><span class="line"></span><br><span class="line">        this.preorder = preorder;</span><br><span class="line">        this.inorder = inorder;</span><br><span class="line">        return BuildTree(0, preorder.Length-1, 0, inorder.Length-1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public TreeNode BuildTree(int prestart, int preend, int instart, int inend)</span><br><span class="line">    &#123;</span><br><span class="line">        TreeNode root = new TreeNode(preorder[prestart]);</span><br><span class="line"></span><br><span class="line">        // 当前序遍历序列只剩下一个节点</span><br><span class="line">        if (prestart == preend)</span><br><span class="line">        &#123;</span><br><span class="line">            // 当中序遍历序列也只剩下一个节点；且前中序遍历序列中的唯一节点数值相等</span><br><span class="line">            if (instart == inend &amp;&amp; preorder[prestart] == inorder[instart])</span><br><span class="line">                return root;</span><br><span class="line">            else</span><br><span class="line">                throw new InvalidOperationException();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        int rootInorder = -1;</span><br><span class="line">        for (int i = instart; i &lt;= inend; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            if (root.val == inorder[i])</span><br><span class="line">                rootInorder = i;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 当在中序遍历序列找不到对应的数字</span><br><span class="line">        if (rootInorder == -1) </span><br><span class="line">            throw new InvalidOperationException();</span><br><span class="line"></span><br><span class="line">        int leftCount = rootInorder - instart;</span><br><span class="line"></span><br><span class="line">        if (rootInorder &gt; instart)</span><br><span class="line">            root.left = BuildTree(prestart + 1, prestart + leftCount, instart, rootInorder-1);</span><br><span class="line"></span><br><span class="line">        if (rootInorder &lt; inend)</span><br><span class="line">            root.right = BuildTree(prestart + leftCount + 1, preend, rootInorder + 1, inend);</span><br><span class="line"></span><br><span class="line">        return root;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Definition for a binary tree node.</span><br><span class="line">    public class TreeNode &#123;</span><br><span class="line">        public int val;</span><br><span class="line">        public TreeNode left;</span><br><span class="line">        public TreeNode right;</span><br><span class="line">        public TreeNode(int x) &#123; val = x; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="易忽略点"><a href="#易忽略点" class="headerlink" title="易忽略点"></a>易忽略点</h3><ol>
<li>本题的非法输入情况比较复杂，主要可以分为三种，我们尤其需要注意处理异常：<ul>
<li>输入前中序遍历序列为空或者长度为0；</li>
<li>前中序遍历序列长度或数字不一致；</li>
<li>前中序遍历序列中数字的排序存在矛盾。</li>
</ul>
</li>
</ol>
</div><div class="tags"><a href="/tags/Binary-Tree%EF%BC%88%E4%BA%8C%E5%8F%89%E6%A0%91%EF%BC%89/"><i class="fa fa-tag"></i>Binary Tree（二叉树）</a></div><div class="post-nav"><a class="pre" href="/2022/03/03/coding-interview/coding-interview-8/">剑指Offer面试题8：二叉树的下一个节点</a><a class="next" href="/2022/02/22/language-csharp/">C#</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://lotuny.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Application/">Application</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Azure/">Azure</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Coding-Interview-Edition-2/">Coding Interview Edition 2</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Command/">Command</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Computer-Network/">Computer Network</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Language/">Language</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Reading/">Reading</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Test/">Test</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Uncategorized/">Uncategorized</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/Blog/" style="font-size: 15px;">Blog</a> <a href="/tags/Computer-Network/" style="font-size: 15px;">Computer Network</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Security/" style="font-size: 15px;">Security</a> <a href="/tags/Web/" style="font-size: 15px;">Web</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/Automation-Test/" style="font-size: 15px;">Automation Test</a> <a href="/tags/Array/" style="font-size: 15px;">Array</a> <a href="/tags/Novella/" style="font-size: 15px;">Novella</a> <a href="/tags/Binary-Tree%EF%BC%88%E4%BA%8C%E5%8F%89%E6%A0%91%EF%BC%89/" style="font-size: 15px;">Binary Tree（二叉树）</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/03/03/coding-interview/coding-interview-9/">剑指Offer面试题9：用两个栈实现队列</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/03/coding-interview/coding-interview-8/">剑指Offer面试题8：二叉树的下一个节点</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/02/coding-interview/coding-interview-7/">剑指Offer面试题7：重建二叉树</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/02/22/language-csharp/">C#</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/02/21/reading/animal-farm/">Animal Farm (2022-03-03)</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/02/21/azure/azure-data-explorer/">Azure Data Explorer (Kusto)</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/02/20/coding-interview/coding-interview-6/">剑指Offer面试题6：从尾到头打印链表</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/02/20/coding-interview/coding-interview-5/">剑指Offer面试题5：替换空格</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/02/20/coding-interview/coding-interview-4/">剑指Offer面试题4：二维数组中的查找</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/02/19/coding-interview/coding-interview-3/">剑指Offer面试题3：数组中重复的数字</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="https://github.com/lotuny" title="GitHub - Lotuny" target="_blank">GitHub - Lotuny</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2022 <a href="/." rel="nofollow">Lotuny's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>